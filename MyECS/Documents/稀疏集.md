# 稀疏集（Sparse Set）

## 组成

稀疏集含有两个数组：`density`、`sparse`  
稀疏集实际上就是两个互相映射的数组  

## 思路

`density` 数组中存储的就是紧密排列的所有实体 ID ，`sparse` 数组中存储的就是实体 ID 对应在 `density` 数组中的下标  

也就是说，映射关系为：  

-  `density` : [Idx] -> EntityID  
- `sparse` : [EntityID] -> Idx  

其中 EntityID 就是实体 ID，是离散的；而 Idx 稀疏集中自增的编号，是连续的

## 操作

### 增删改查

都是 O(1) 的，因为可以通过 ID 直接找到并修改具体值

其中删除操作有些不同：  
删除操作需要先将待删除元素与末尾元素交换，然后删除末尾元素；交换过程中同时更新对应的原末尾元素的索引

## 页表优化

由于 sparse 数组中空洞可能会很大，所以在 EnTT 中做了页表优化  

将 sparse 换做了一个二维数组，原先的一维中的每一个位置上都换为了一个数组，称为页，大小为 m  

存储数据 x 时，x / m 是页编号，x % m 是页中位置  

如果某一页没有数据，就可以不给这页在内存中申请空间  

## 对比其他结构

### 哈希表

Sparse Set 对纯非负整数优化极大，不会有冲突，且内存友好  
